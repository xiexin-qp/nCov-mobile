(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-346ef939"],{"02a7":function(t,e,a){t.exports=a.p+"img/no-data.b1289545.png"},8262:function(t,e,a){t.exports=a.p+"img/face.4b5fee4d.png"},"89c3":function(t,e,a){},a35d:function(t,e,a){"use strict";a.r(e);a("ed63"),a("8cf2"),a("9a33");var r=a("7c6b"),u=a.n(r),n=(a("b449"),a("17d6")),c=a("8bbf"),s=a.n(c),i=(a("5ab2"),a("6d57"),a("e10e"),a("b081")),o="",h="",f="",p="";f=o="/api-mobile-ncov";var l={wangxuanzhang:o,zhangkukn:h,zhuxu:f,lvzhuo:p,host:"http://canpointlive.com",zx:"/zx_visitor",zk:"/zk_school",hpb_face:"/hpb_face",zk_face:"/zk_face"};function d(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}var b={getUserInfo:"/parents/student/getUserInfoByPhone#getUrl",updateUser:"/parents/student/updateParentPhoto#post"};for(var g in b)b[g]="".concat(l.zk_face).concat(b[g]);function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}var m=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach(function(t){Object(i.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?d(Object(a),!0).forEach(function(t){Object(i.a)(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}({},b),{facePhoto:"".concat(l.hpb_face,"/facePhoto")}),x=a("c1e3");function O(e){return new Promise(function(t){t(e)})}function w(i){var o=m[i].split("#")[0],h=m[i].split("#")[1];_[i]=Object(n.a)(u.a.mark(function t(){var e,a,r,n,c,s=arguments;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0<s.length&&void 0!==s[0]?s[0]:{},a=void 0===m[i].split("#")[2],r="getUrl"===h?"get":h,n="getUrl"===h,t.next=6,x.a[r]({url:n||"del"===h?o+"/"+e:o,params:n?{}:e},a);case 6:return c=t.sent,t.abrupt("return",O(c));case 8:case"end":return t.stop()}},t)}))}var j,y,k="face",P=window.sessionStorage.getItem(k)||"{}",_=(s.a.observable({count:(j="count",y=1,JSON.parse(P)[j]||y)}),Object.create(null));for(var D in m)w(D);var C,F,I,L=a("02a7"),z=a.n(L),S={name:"NoData",props:{msg:{type:String,default:""}},data:function(){return{noData:z.a}}},U=(a("ba22"),a("e90a")),H=Object(U.a)(S,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"no-data qui-fx-ac-jc"},[a("div",[a("img",{staticClass:"no-data-img",attrs:{src:t.noData,alt:""}})]),a("p",[t._v(t._s(t.msg))])])},[],!1,null,"8f3a262e",null).exports,W=a("5501"),E=a.n(W),$=a("30b7"),q=a.n($),N=a("cebe"),J=a.n(N),R=a("8262"),M=a.n(R),A={name:"Face",components:{NoData:H},computed:{},beforeCreate:function(){window.document.title="人脸录入"},data:function(){return{total:0,searchForm:{phone:""},autoImg:M.a,currentIndex:"",faceList:[]}},methods:{searchList:(I=Object(n.a)(u.a.mark(function t(){var e,a;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=/^1[3456789]\d{9}$/,""!==this.searchForm.phone&&e.test(this.searchForm.phone)){t.next=4;break}return this.$notify("请输入正确的手机号"),t.abrupt("return",!1);case 4:return t.next=6,_.getUserInfo(this.searchForm.phone);case 6:a=t.sent,this.faceList=a.data.parentDtoList||[],this.total=this.faceList.length;case 9:case"end":return t.stop()}},t,this)})),function(){return I.apply(this,arguments)}),changeFile:function(t,e){var a=this;this.currentIndex=e;var r=new FileReader;r.onload=function(){var t=new Image;t.src=r.result;var e=a;t.onload=function(){E.a.getData(this,function(){e.Orientation=E.a.getTag(this,"Orientation"),(800<t.width||800<t.height)&&(t.width=450,t.height=600),e.ctxWidth=t.width,e.ctxHeight=t.height,e.ontpys(t)})}},r.readAsDataURL(t.target.files[0])},checkPhoto:(F=Object(n.a)(u.a.mark(function t(e){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,J.a.post("".concat(l.hpb_face,"/facePhoto"),q.a.stringify({userCode:Math.floor(1e5*Math.random()),file:e.split(",")[1]}));case 3:t.sent.data.data.result?this.uploadFace(e):this.$dialog({title:"提示",message:"您上传的人脸照片不符合规范，请重新上传"}).then(function(){}),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0);case 10:case"end":return t.stop()}},t,this,[[0,7]])})),function(t){return F.apply(this,arguments)}),ontpys:function(t){var e=document.createElement("canvas"),a=e.getContext("2d");switch(e.width=this.ctxWidth,e.height=this.ctxHeight,[5,6,7,8].includes(this.Orientation)&&(e.width=this.ctxHeight,e.height=this.ctxWidth),this.Orientation){case 2:a.transform(-1,0,0,1,this.ctxWidth,0);break;case 3:a.transform(-1,0,0,-1,this.ctxWidth,this.ctxHeight);break;case 4:a.transform(1,0,0,-1,0,this.ctxHeight);break;case 5:a.transform(0,1,1,0,0,0);break;case 6:a.transform(0,1,-1,0,this.ctxHeight,0);break;case 7:a.transform(0,-1,-1,0,this.ctxHeight,this.ctxWidth);break;case 8:a.transform(0,-1,1,0,0,this.ctxWidth);break;default:a.transform(1,0,0,1,0,0)}a.drawImage(t,0,0,this.ctxWidth,this.ctxHeight);var r=e.toDataURL("image/jpeg",.8);this.checkPhoto(r)},uploadFace:(C=Object(n.a)(u.a.mark(function t(e){return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,_.updateUser({userId:this.faceList[this.currentIndex].userId,base64:e.split(",")[1]});case 3:this.faceList[this.currentIndex].photoSrc=e,this.$dialog({title:"提示",message:"人脸更新成功"}).then(function(){}),t.next=9;break;case 7:t.prev=7,t.t0=t.catch(0);case 9:case"end":return t.stop()}},t,this,[[0,7]])})),function(t){return C.apply(this,arguments)})},mounted:function(){}},B=(a("ba89"),Object(U.a)(A,function(){var a=this,t=a.$createElement,r=a._self._c||t;return r("div",{staticClass:"face qui-fx-ver"},[r("div",{staticClass:"tip"},[a._v("输入手机号进行查询，可查询到绑定孩子的相关家属信息~")]),r("div",{staticClass:"input-box qui-fx-ac"},[r("input",{directives:[{name:"model",rawName:"v-model",value:a.searchForm.phone,expression:"searchForm.phone"}],attrs:{type:"tel",placeholder:"请输入手机号"},domProps:{value:a.searchForm.phone},on:{input:function(t){t.target.composing||a.$set(a.searchForm,"phone",t.target.value)}}})]),r("div",{staticClass:"search-btn",on:{click:a.searchList}},[a._v("查询")]),0<a.faceList.length?r("div",{staticClass:"msg qui-fx-jsb"},[r("div",[a._v("查询到"+a._s(a.total)+"位家属")]),r("div",{staticStyle:{color:"#999"}},[a._v("拍照时请拍正脸区域")])]):a._e(),0===a.faceList.length?r("no-data",{attrs:{msg:"暂无查询数据"}}):a._e(),a._l(a.faceList,function(t,e){return r("div",{key:e,staticClass:"face-list"},[r("div",{staticClass:"div-img"},[r("img",{attrs:{src:t.photoSrc||a.autoImg,alt:""}})]),r("div",{staticClass:"qui-fx-ac qui-fx-jsa"},[r("div",{staticClass:"name"},[a._v(a._s(t.userName))]),r("a",{staticClass:"file",attrs:{href:"javascript:;"}},[a._v("\n        更新人脸\n        "),r("input",{attrs:{type:"file",accept:"image/*",capture:"camera"},on:{change:function(t){return a.changeFile(t,e)}}})])])])})],2)},[],!1,null,"3d73224e",null));e.default=B.exports},ba22:function(t,e,a){"use strict";var r=a("bbe7");a.n(r).a},ba89:function(t,e,a){"use strict";var r=a("89c3");a.n(r).a},bbe7:function(t,e,a){}}]);